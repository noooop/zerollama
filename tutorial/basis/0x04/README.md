# 流式推理(边生产边返回)

这个功能用来支持流式推理，生成一个字，输出一个字，明显能提高用户体验

```
$ python main.py
Client sending request 0 …
b'0000000000'
b'0000000001'
b'0000000002'
b'0000000003'
b'0000000004'
b'0000000005'
b'0000000006'
b'0000000007'
b'0000000008'
b'0000000009'
b'done!'
...
```

当然使用 zmq REP 和 REQ 做不到真正的流式推理， 因为：

[第二章 ZeroMQ进阶](https://wizardforcel.gitbooks.io/zmq-guide/content/chapter2.html)

> 在发送多帧消息时，只有当最后一帧提交发送了，整个消息才会被发送；
> 如果使用了zmq_poll()函数，当收到了消息的第一帧时，其它帧其实也已经收到了；
> 多帧消息是整体传输的，不会只收到一部分；
> 多帧消息的每一帧都是一个zmq_msg结构；
> 无论你是否检查套接字的ZMQ_RCVMORE选项，你都会收到所有的消息；
> 发送时，ZMQ会将开始的消息帧缓存在内存中，直到收到最后一帧才会发送；
> 我们无法在发送了一部分消息后取消发送，只能关闭该套接字。

所以需要 zmq DEALER 和 ROUTER